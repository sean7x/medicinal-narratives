schema: '2.0'
stages:
  extract_sample:
    cmd: python src/extract_sample.py --input_path data/raw/lewtun-drug-reviews/train.jsonl
      --output_path data/raw/lewtun-drug-reviews/sample_train.jsonl
    deps:
    - path: data/raw/lewtun-drug-reviews/train.jsonl
      hash: md5
      md5: 5bfa955b0f63f5c91db7c77ee4d14d95
      size: 97686013
    - path: src/extract_sample.py
      hash: md5
      md5: 55ab61600a77c4a09addf00931b5dbae
      size: 2069
    params:
      params.yaml:
        RANDOM_SEED: 42
        extract_sample:
          fraction: 0.2
          stratify_column:
    outs:
    - path: data/raw/lewtun-drug-reviews/sample_train.jsonl
      hash: md5
      md5: b0a4e142db1f06fc38e7580809d09abe
      size: 19310433
  preprocess:
    cmd: python src/preprocessing.py --input_path data/raw/lewtun-drug-reviews/sample_train.csv
      --output_path data/preprocessed/lewtun-drug-reviews/procd_sample_train.csv
    deps:
    - path: data/raw/lewtun-drug-reviews/sample_train.csv
      hash: md5
      md5: fe6e3f3aa8d697526f0907b3befedf43
      size: 16599199
    - path: src/preprocessing.py
      hash: md5
      md5: e3d72c7884b2e82c48acbc57cd8a43e1
      size: 1937
    outs:
    - path: data/preprocessed/lewtun-drug-reviews/procd_sample_train.csv
      hash: md5
      md5: 94967cda454b25b48b78b082f7b9752d
      size: 27333994
  feature_engineering:
    cmd: python src/feature_engineering.py --input_path data/preprocessed/lewtun-drug-reviews/procd_sample_train.csv
      --bow true --tfidf true --word2vec true --vector_size 100 --window 5 --min_count
      1 --epochs 10 --workers -1 --bert true
    deps:
    - path: src/feature_engineering.py
      hash: md5
      md5: 4438b6e78b5d4d905357bd42c6126444
      size: 4998
    params:
      params.yaml:
        feature_engineering:
          input_path: data/preprocessed/lewtun-drug-reviews/procd_sample_train.csv
          bow: true
          tfidf: true
          word2vec:
            enabled: true
            vector_size: 100
            window: 5
            min_count: 1
            epochs: 10
            workers: -1
          bert: true
    outs:
    - path: data/features/bert_embeddings.pkl
      hash: md5
      md5: 85b994743bdba3e61ddf24be2dc3af22
      size: 3782139974
    - path: data/features/bow_corpus.pkl
      hash: md5
      md5: 2a1540722a532ec9f0f84e49d79c9f5a
      size: 7029158
    - path: data/features/dictionary.pkl
      hash: md5
      md5: 18f0c038234996327e8aea59abf959e1
      size: 1029442
    - path: data/features/tfidf_corpus.pkl
      hash: md5
      md5: f7a0c3f43958c2a45b16ffe83b252cef
      size: 24628593
    - path: data/features/word2vec_model.pkl
      hash: md5
      md5: 1189b51a8d6fa8a987f6d1d48c8a47ba
      size: 32977113
  topic_modeling_bow_tfidf:
    cmd: python src/topic_modeling_bow_tfidf.py --procd_data_path data/preprocessed/lewtun-drug-reviews/procd_sample_train.csv
      --bow_corpus_path data/features/bow_corpus.pkl --tfidf_corpus_path data/features/tfidf_corpus.pkl
      --dictionary_path data/features/dictionary.pkl --lda_n_topics 10 --nmf_n_topics
      10 --lda_bow_model_path data/models/lda_bow_model.pkl --nmf_bow_model_path data/models/nmf_bow_model.pkl
      --lda_tfidf_model_path data/models/lda_tfidf_model.pkl --nmf_tfidf_model_path
      data/models/nmf_tfidf_model.pkl
    deps:
    - path: data/features/bert_embeddings.pkl
      hash: md5
      md5: 85b994743bdba3e61ddf24be2dc3af22
      size: 3782139974
    - path: data/features/bow_corpus.pkl
      hash: md5
      md5: 2a1540722a532ec9f0f84e49d79c9f5a
      size: 7029158
    - path: data/features/dictionary.pkl
      hash: md5
      md5: 18f0c038234996327e8aea59abf959e1
      size: 1029442
    - path: data/features/tfidf_corpus.pkl
      hash: md5
      md5: f7a0c3f43958c2a45b16ffe83b252cef
      size: 24628593
    - path: data/features/word2vec_model.pkl
      hash: md5
      md5: 1189b51a8d6fa8a987f6d1d48c8a47ba
      size: 32977113
    - path: src/topic_modeling_bow_tfidf.py
      hash: md5
      md5: 714d383b2b8ed50a42e5f6d4d5721dad
      size: 4799
    params:
      params.yaml:
        topic_modeling_bow_tfidf:
          procd_data_path: data/preprocessed/lewtun-drug-reviews/procd_sample_train.csv
          lda_n_topics: 10
          nmf_n_topics: 10
    outs:
    - path: data/models/lda_bow_model.pkl
      hash: md5
      md5: c37699c5cd12d95c7591beb9f6814fbe
      size: 161565
    - path: data/models/lda_tfidf_model.pkl
      hash: md5
      md5: 1b13c5e36c0a171e1c98bb7a5043aea6
      size: 161566
    - path: data/models/nmf_bow_model.pkl
      hash: md5
      md5: 6d820b09f04ae80ad5072053ba75545b
      size: 7671484
    - path: data/models/nmf_tfidf_model.pkl
      hash: md5
      md5: 5e3229289e31b1daf5da187299a3b256
      size: 7671487
  preprocess_sample_train:
    cmd: python src/preprocessing.py --input_path data/raw/lewtun-drug-reviews/sample_train.csv
      --output_path data/preprocessed/lewtun-drug-reviews/procd_sample_train.csv
    deps:
    - path: data/raw/lewtun-drug-reviews/sample_train.csv
      hash: md5
      md5: 41087367fcf435c6561149e067e13d57
      size: 16631460
    - path: src/preprocessing.py
      hash: md5
      md5: 1b5817319fb04efc5c59eca0a770500d
      size: 2816
    outs:
    - path: data/preprocessed/lewtun-drug-reviews/procd_sample_train.csv
      hash: md5
      md5: f53318ba9f8f5962361fe10d3f50b4d6
      size: 49239264
  feature_engineering_sample_train:
    cmd: python src/feature_engineering.py --input_path data/preprocessed/lewtun-drug-reviews/procd_sample_train.csv
    deps:
    - path: data/preprocessed/lewtun-drug-reviews/procd_sample_train.csv
      hash: md5
      md5: f53318ba9f8f5962361fe10d3f50b4d6
      size: 49239264
    - path: src/feature_engineering.py
      hash: md5
      md5: 0b9c23856834f9df2b528b94cbc2eefe
      size: 5291
    params:
      params.yaml:
        RANDOM_SEED: 42
        feature_engineering:
          bow: true
          tfidf: true
          word2vec:
            enabled: true
            vector_size: 100
            window: 5
            min_count: 1
            epochs: 10
            sg: 0
          bert: true
    outs:
    - path: data/features/bert_embeddings.pkl
      hash: md5
      md5: 68cbdadf68829e274149503423785b29
      size: 8581293681
    - path: data/features/bow_corpus.pkl
      hash: md5
      md5: f8e336cf2db0f9af640da38c45c97a89
      size: 6749703
    - path: data/features/dictionary.pkl
      hash: md5
      md5: 2e401ce9763e090090874f44680617a8
      size: 643505
    - path: data/features/tfidf_corpus.pkl
      hash: md5
      md5: b9bd7a7d9f28e3a5951d5a9b60cc821c
      size: 23717388
    - path: data/features/word2vec_model.pkl
      hash: md5
      md5: 560ab3e4c02ce89fdcf98ce2f5c1369c
      size: 27088773
  topic_modeling_bow_tfidf_sample_train:
    cmd: python src/topic_modeling.py --procd_data_path data/preprocessed/lewtun-drug-reviews/procd_sample_train.csv
      --bow_corpus_path data/features/bow_corpus.pkl --tfidf_corpus_path data/features/tfidf_corpus.pkl
      --dictionary_path data/features/dictionary.pkl --lda_bow_model_path models/lda_bow_model.pkl
      --nmf_bow_model_path models/nmf_bow_model.pkl --lda_tfidf_model_path models/lda_tfidf_model.pkl
      --nmf_tfidf_model_path models/nmf_tfidf_model.pkl --lda_bow_vis_path plots/lda_bow_vis.html
      --lda_tfidf_vis_path plots/lda_tfidf_vis.html --nmf_bow_vis_path plots/nmf_bow_vis.html
      --nmf_tfidf_vis_path plots/nmf_tfidf_vis.html
    deps:
    - path: data/features/bert_embeddings.pkl
      hash: md5
      md5: 68cbdadf68829e274149503423785b29
      size: 8581293681
    - path: data/features/bow_corpus.pkl
      hash: md5
      md5: f8e336cf2db0f9af640da38c45c97a89
      size: 6749703
    - path: data/features/dictionary.pkl
      hash: md5
      md5: 2e401ce9763e090090874f44680617a8
      size: 643505
    - path: data/features/tfidf_corpus.pkl
      hash: md5
      md5: b9bd7a7d9f28e3a5951d5a9b60cc821c
      size: 23717388
    - path: data/features/word2vec_model.pkl
      hash: md5
      md5: 560ab3e4c02ce89fdcf98ce2f5c1369c
      size: 27088773
    - path: data/preprocessed/lewtun-drug-reviews/procd_sample_train.csv
      hash: md5
      md5: f53318ba9f8f5962361fe10d3f50b4d6
      size: 49239264
    - path: src/topic_modeling.py
      hash: md5
      md5: 26d441fe56d0542eb4288a887ae9623f
      size: 7710
    params:
      params.yaml:
        RANDOM_SEED: 42
        topic_modeling:
          num_topics: 10
    outs:
    - path: models/lda_bow_model.pkl
      hash: md5
      md5: 830ed8ec4a13d946981d13804569dfa4
      size: 114542
    - path: models/lda_tfidf_model.pkl
      hash: md5
      md5: d525ccd3322cd7ae8bb4e12e54da5144
      size: 114544
    - path: models/nmf_bow_model.pkl
      hash: md5
      md5: 80b3cb407436e65632e484a3dc2f2336
      size: 5310347
    - path: models/nmf_tfidf_model.pkl
      hash: md5
      md5: 805014c1ef91e5f5b4062e8949d8cfb1
      size: 5310349
    - path: plots/lda_bow_vis.html
      hash: md5
      md5: 7aa1cfdab5e280617da4e5d5c05ff0f4
      size: 150188
    - path: plots/lda_tfidf_vis.html
      hash: md5
      md5: 6604c6d9a81147f90532c720e90af316
      size: 95638
    - path: plots/nmf_bow_vis.html
      hash: md5
      md5: 1f297ad6828f1f4a0ec1db43e03abd3d
      size: 178297
    - path: plots/nmf_tfidf_vis.html
      hash: md5
      md5: be92437596cce08611972bbd20ef76f1
      size: 143874
  clustering_bow_tfidf_sample_train:
    cmd: python src/clustering.py --model_paths 
      "models/lda_bow_model.pkl,models/lda_tfidf_model.pkl,models/nmf_bow_model.pkl,models/nmf_tfidf_model.pkl"
      --corpus_paths "data/features/bow_corpus.pkl,data/features/tfidf_corpus.pkl"
      --log_dir clustering_bow_tfidf
    deps:
    - path: data/features/bow_corpus.pkl
      hash: md5
      md5: f8e336cf2db0f9af640da38c45c97a89
      size: 6749703
    - path: data/features/tfidf_corpus.pkl
      hash: md5
      md5: b9bd7a7d9f28e3a5951d5a9b60cc821c
      size: 23717388
    - path: models/lda_bow_model.pkl
      hash: md5
      md5: 830ed8ec4a13d946981d13804569dfa4
      size: 114542
    - path: models/lda_tfidf_model.pkl
      hash: md5
      md5: d525ccd3322cd7ae8bb4e12e54da5144
      size: 114544
    - path: models/nmf_bow_model.pkl
      hash: md5
      md5: 80b3cb407436e65632e484a3dc2f2336
      size: 5310347
    - path: models/nmf_tfidf_model.pkl
      hash: md5
      md5: 805014c1ef91e5f5b4062e8949d8cfb1
      size: 5310349
    - path: src/clustering.py
      hash: md5
      md5: f446d6a464d17f2b60cff944d087e8db
      size: 5867
    params:
      params.yaml:
        RANDOM_SEED: 42
        clustering:
          num_clusters: 10
          eps: 0.2
          min_samples: 5
    outs:
    - path: models/lda_bow_dbscan.pkl
      hash: md5
      md5: e93dbf0e50643ef237dda76ab1c997bb
      size: 1148829
    - path: models/lda_bow_hierarchical.pkl
      hash: md5
      md5: b53ab3ca22b0b2ab5a69b66124a2663e
      size: 774809
    - path: models/lda_bow_kmeans.pkl
      hash: md5
      md5: fbf62e836c2acc539f145706efe5b80b
      size: 130458
    - path: models/lda_tfidf_dbscan.pkl
      hash: md5
      md5: e39e7c485a5d11b5f9def882d524b46f
      size: 1423037
    - path: models/lda_tfidf_hierarchical.pkl
      hash: md5
      md5: 851e92ac230b79768e4ee2395ef69332
      size: 774809
    - path: models/lda_tfidf_kmeans.pkl
      hash: md5
      md5: 9d42c43c709b96017182ae63966199c2
      size: 130458
    - path: models/nmf_bow_dbscan.pkl
      hash: md5
      md5: a47336fc224ba348b2d3cdb7c5b45d9a
      size: 399412
    - path: models/nmf_bow_hierarchical.pkl
      hash: md5
      md5: dcd2f48f02aba052b9eaedba8bad67c3
      size: 774809
    - path: models/nmf_bow_kmeans.pkl
      hash: md5
      md5: c6002c51e352eb1cb9619bd936825671
      size: 130458
    - path: models/nmf_tfidf_dbscan.pkl
      hash: md5
      md5: 4a15e50eda1ad6014d2c550c76c3191f
      size: 382604
    - path: models/nmf_tfidf_hierarchical.pkl
      hash: md5
      md5: 9f8ee49a1ecd346b44532fa2540af0c6
      size: 774809
    - path: models/nmf_tfidf_kmeans.pkl
      hash: md5
      md5: 841bd359d95ed93fb7dc3d41db4de7dc
      size: 130458
  clustering_word2vec_bert_sample_train:
    cmd: python src/clustering.py --model_paths "data/features/word2vec_model.pkl,data/features/bert_embeddings.pkl"
      --log_dir clustering_word2vec_bert
    deps:
    - path: data/features/bert_embeddings.pkl
      hash: md5
      md5: 68cbdadf68829e274149503423785b29
      size: 8581293681
    - path: data/features/word2vec_model.pkl
      hash: md5
      md5: 560ab3e4c02ce89fdcf98ce2f5c1369c
      size: 27088773
    - path: src/clustering.py
      hash: md5
      md5: f446d6a464d17f2b60cff944d087e8db
      size: 5867
    params:
      params.yaml:
        RANDOM_SEED: 42
        clustering:
          num_clusters: 10
          eps: 0.2
          min_samples: 5
    outs:
    - path: models/bert_dbscan.pkl
      hash: md5
      md5: 76a1a6d000569622f452ee6e5d382fe7
      size: 397212
    - path: models/bert_hierarchical.pkl
      hash: md5
      md5: 5b9936b14c8d97082da469ebec010f85
      size: 774810
    - path: models/bert_kmeans.pkl
      hash: md5
      md5: 05fc606717c7e5b5d487a73e199c643f
      size: 160414
    - path: models/word2vec_dbscan.pkl
      hash: md5
      md5: 259ef41a2674dd53828773e7c012b2e4
      size: 260282
    - path: models/word2vec_hierarchical.pkl
      hash: md5
      md5: 56c45cd6913f9d38b7e42581e9f14445
      size: 779873
    - path: models/word2vec_kmeans.pkl
      hash: md5
      md5: 51d776fab3d12bca61e432afe2a861eb
      size: 134536
  preprocess_train:
    cmd: python src/preprocessing.py --input_path data/raw/lewtun-drug-reviews/sample_train.jsonl
      --output_path data/preprocessed/procd_sample_train.csv
    deps:
    - path: data/raw/lewtun-drug-reviews/sample_train.jsonl
      hash: md5
      md5: b0a4e142db1f06fc38e7580809d09abe
      size: 19310433
    - path: src/preprocessing.py
      hash: md5
      md5: af652414701a10d3f52009848af259ff
      size: 2960
    params:
      params.yaml:
        train_data_path: sample_train
    outs:
    - path: data/preprocessed/procd_sample_train.csv
      hash: md5
      md5: aed115c3821c04328a0405672b37f1c8
      size: 49165394
  feature_engineering_train:
    cmd: python src/feature_engineering.py --procd_data_path data/preprocessed/procd_sample_train.csv
    deps:
    - path: data/preprocessed/procd_sample_train.csv
      hash: md5
      md5: aed115c3821c04328a0405672b37f1c8
      size: 49165394
    - path: src/feature_engineering.py
      hash: md5
      md5: 5914cbe6251c2c9add9065dfc32af3f1
      size: 4370
    params:
      params.yaml:
        RANDOM_SEED: 42
        feature_engineering:
          bow: true
          tfidf: true
          ngram: bigram
          bert: true
          bert_pretrained_model: bert-base-uncased
        procd_text: lemma_w_stpwrd
        train_data_path: sample_train
    outs:
    - path: data/features/bert_embeddings.pkl
      hash: md5
      md5: acf9363dff3715b5932b9f431d86f28e
      size: 8567430177
    - path: data/features/bow_bigram_corpus.pkl
      hash: md5
      md5: ec4db8361d72669febdba6f02d35876a
      size: 10657331
    - path: data/features/dictionary_bigram.pkl
      hash: md5
      md5: c5f719bd3d53147cca8e3805be143478
      size: 2291775
    - path: data/features/tfidf_bigram_corpus.pkl
      hash: md5
      md5: b174460859df9a5e1a2119c6bd81e982
      size: 37546079
  clustering_bert_train:
    cmd: python src/clustering.py --model_path data/features/bert_embeddings.pkl --log_dir
      clustering_bert
    deps:
    - path: data/features/bert_embeddings.pkl
      hash: md5
      md5: acf9363dff3715b5932b9f431d86f28e
      size: 8567430177
    - path: src/clustering.py
      hash: md5
      md5: fd6953cfe27681e8e8a7c8ef0d69325c
      size: 4876
    params:
      params.yaml:
        RANDOM_SEED: 42
        clustering_bert:
          algorithm: kmeans
          num_clusters: 2
          eps: 0.2
          min_samples: 5
    outs:
    - path: ./models/bert_kmeans.pkl
      hash: md5
      md5: a47ee02acfe46eb253c07c264bc46afa
      size: 135834
  topic_modeling:
    cmd: python src/topic_modeling.py --procd_data_path data/preprocessed/procd_sample_train.csv
      --dictionary_path data/features/dictionary_bigram.pkl
    deps:
    - path: ./models/bert_kmeans.pkl
      hash: md5
      md5: a47ee02acfe46eb253c07c264bc46afa
      size: 135834
    - path: data/features/dictionary_bigram.pkl
      hash: md5
      md5: c5f719bd3d53147cca8e3805be143478
      size: 2291775
    - path: data/features/tfidf_bigram_corpus.pkl
      hash: md5
      md5: b174460859df9a5e1a2119c6bd81e982
      size: 37546079
    - path: data/preprocessed/procd_sample_train.csv
      hash: md5
      md5: aed115c3821c04328a0405672b37f1c8
      size: 49165394
    - path: src/topic_modeling.py
      hash: md5
      md5: b1b7b9a5fe0081fffae63939a46d8a74
      size: 6849
    params:
      params.yaml:
        RANDOM_SEED: 42
        feature_engineering.ngram: bigram
        procd_text: lemma_w_stpwrd
        topic_modeling:
          feature: tfidf
          algorithm: lda
          cluster: true
          num_topics: 8
        train_data_path: sample_train
